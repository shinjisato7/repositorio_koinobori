<!-- Generated by documentation.js. Update this documentation by updating the source code. -->

### Table of Contents

- [Run loop entanglement via \`\*Task\` functions][1]
  - [runTask][2]
    - [Parameters][3]
  - [pollTask][4]
    - [Parameters][5]
  - [pollTaskFor][6]
    - [Parameters][7]
  - [setShouldPoll][8]
    - [Parameters][9]
  - [scheduleTask][10]
    - [Parameters][11]
  - [debounceTask][12]
    - [Parameters][13]
  - [throttleTask][14]
    - [Parameters][15]
  - [cancelTask][16]
    - [Parameters][17]
  - [cancelPoll][18]
    - [Parameters][19]
  - [cancelDebounce][20]
    - [Parameters][21]
- [DOM event handler entanglement][22]
  - [addEventListener][23]
    - [Parameters][24]
  - [removeEventListener][25]
    - [Parameters][26]
- [Disposables][27]
  - [registerDisposable][28]
    - [Parameters][29]
  - [runDisposables][30]
    - [Parameters][31]
- [Mixins][32]
  - [DisposableMixin][33]
  - [ContextBoundEventListenersMixin][34]
  - [ContextBoundTasksMixin][35]

## Run loop entanglement via \`\*Task\` functions

### runTask

Registers and runs the provided task function for the provided object at the specified
timeout (defaulting to 0). The timer is properly canceled if the object is destroyed
before it is invoked.

Example:

```js
import Component from 'ember-component';
import { runTask, runDisposables } from 'ember-lifeline';

export default Component.extend({
  didInsertElement() {
    runTask(
      this,
      () => {
        console.log(
          'This runs after 5 seconds if this component is still displayed'
        );
      },
      5000
    );
  },

  willDestroy() {
    this._super(...arguments);

    runDisposables(this);
  },
});
```

#### Parameters

- `destroyable` **IDestroyable** the instance to register the task for
- `taskOrName` **([Function][36] \| [String][37])** a function representing the task, or string
  specifying a property representing the task,
  which is run at the provided time specified
  by timeout
- `timeout` **[Number][38]** the time in the future to run the task (optional, default `0`)

### pollTask

Sets up a function that can perform polling logic in a testing safe way.
The task is invoked synchronously with an argument (generally called `next`).
In normal development/production when `next` is invoked, it will trigger the
task again (recursively). However, when in test mode the recursive polling
functionality is disabled, and usage of the `pollTaskFor` helper is required.

Example:

```js
import { pollTask, runTask, runDisposables } from 'ember-lifeline';

export default Component.extend({
  api: injectService(),

  init() {
    this._super(...arguments);

    let token = pollTask(this, next => {
      this.get('api')
        .request('get', 'some/path')
        .then(() => {
          runTask(this, next, 1800);
        });
    });

    this._pollToken = token;
  },

  willDestroy() {
    this._super(...arguments);

    runDisposables(this);
  },
});
```

Test Example:

```js
import wait from 'ember-test-helpers/wait';
import { pollTaskFor } from 'ember-lifeline';

//...snip...

test('foo-bar watches things', async function(assert) {
  await render(hbs`{{foo-bar}}`);

  return wait()
    .then(() => {
      assert.equal(serverRequests, 1, 'called initially');

      pollTaskFor(this._pollToken);
      return wait();
    })
    .then(() => {
      assert.equal(serverRequests, 2, 'called again');
    });
});
```

#### Parameters

- `destroyable` **IDestroyable** the entangled object that was provided with the original \*Task call
- `taskOrName` **([Function][36] \| [String][37])** a function representing the task, or string
  specifying a property representing the task,
  which is run at the provided time specified
  by timeout
- `token` **Token** the Token for the pollTask, either a String or Number

### pollTaskFor

#### Parameters

- `token`

### setShouldPoll

#### Parameters

- `callback`

### scheduleTask

Adds the provided function to the named queue for the provided object. The timer is
properly canceled if the object is destroyed before it is invoked.

Example:

```js
import Component from 'ember-component';
import { scheduleTask, runDisposables } from 'ember-lifeline';

export default Component.extend({
  init() {
    this._super(...arguments);

    scheduleTask(this, 'actions', () => {
      console.log(
        'This runs at the end of the run loop (via the actions queue) if this component is still displayed'
      );
    });
  },

  willDestroy() {
    this._super(...arguments);

    runDisposables(this);
  },
});
```

#### Parameters

- `destroyable` **IDestroyable** the instance to register the task for
- `queueName` **[String][37]** the queue to schedule the task into
- `taskOrName` **([Function][36] \| [String][37])** a function representing the task, or string
  specifying a property representing the task,
  which is run at the provided time specified
  by timeout
- `args` **...any** arguments to pass to the task

### debounceTask

Runs the function with the provided name after the timeout has expired on the last
invocation. The timer is properly canceled if the object is destroyed before it is
invoked.

Example:

```js
import Component from 'ember-component';
import { debounceTask, runDisposables } from 'ember-lifeline';

export default Component.extend({
  logMe() {
    console.log('This will only run once every 300ms.');
  },

  click() {
    debounceTask(this, 'logMe', 300);
  },

  willDestroy() {
    this._super(...arguments);

    runDisposables(this);
  },
});
```

#### Parameters

- `destroyable` **IDestroyable** the instance to register the task for
- `name` **[String][37]** the name of the task to debounce
- `debounceArgs` **...any** arguments to pass to the debounced method
- `spacing` **[Number][38]** the amount of time to wait before calling the method (in milliseconds)
- `immediate` **[Boolean][39]?** Trigger the function on the leading instead of the trailing edge of the wait interval. Defaults to false.

### throttleTask

Runs the function with the provided name immediately, and only once in the time window
specified by the spacing argument.

Example:

```js
import Component from 'ember-component';
import { throttleTask, runDisposables } from 'ember-lifeline';

export default Component.extend({
  logMe() {
    console.log('This will run once immediately, then only once every 300ms.');
  },

  click() {
    throttleTask(this, 'logMe', 300);
  },

  destroy() {
    this._super(...arguments);

    runDisposables(this);
  },
});
```

#### Parameters

- `destroyable` **IDestroyable** the instance to register the task for
- `taskName` **[String][37]** the name of the task to throttle
- `throttleArgs` **...any?** arguments to pass to the throttled method
- `spacing` **[Number][38]** the time in the future to run the task
- `immediate` **[Boolean][39]?** Trigger the function on the leading instead of the trailing edge of the wait interval. Defaults to true.

### cancelTask

#### Parameters

- `destroyable`
- `cancelId`

### cancelPoll

#### Parameters

- `destroyable`
- `_token`

### cancelDebounce

Cancel a previously debounced task.

Example:

```js
import Component from 'ember-component';
import { debounceTask, cancelDebounce } from 'ember-lifeline';

export default Component.extend({
  logMe() {
    console.log('This will only run once every 300ms.');
  },

  click() {
    debounceTask(this, 'logMe', 300);
  },

  disable() {
    cancelDebounce(this, 'logMe');
  },

  willDestroy() {
    this._super(...arguments);

    runDisposables(this);
  },
});
```

#### Parameters

- `destroyable` **IDestroyable** the instance to register the task for
- `methodName` **[String][37]** the name of the debounced method to cancel

## DOM event handler entanglement

### addEventListener

Attaches an event listener that will automatically be removed when the host
object is dropped from DOM.

Example:

```js
import Component from 'ember-component';
import { addEventListener } from 'ember-lifeline';

export default Component.extend({
  didInsertElement() {
    addEventListener(this, '.some-item', 'click', e => {
      console.log('.some-item was clicked');
    });
  },
});
```

This can also be used in other ember types like services and controllers. In
order to use it there an html element reference must be used instead of a
css selector. This way we can be sure the element actually exists when the
listener is attached:

```js
import Service from 'ember-service';
import { addEventListener } from 'ember-lifeline';

export default Service.extend({
  init() {
    this._super(...arguments);
    const el = document.querySelector('.foo');
    addEventListener(this, el, 'click');
  },
});
```

#### Parameters

- `destroyable` **IDestroyable** the instance to attach the listener for
- `target` **EventTarget** the EventTarget, e.g. DOM element or `window`
- `eventName` **[String][37]** the event name to listen for
- `callback` **[Function][36]** the callback to run for that event
- `options` **any** additional options provided to the browser's `addEventListener`

### removeEventListener

Removes an event listener explicitly from the target, also removing it from
lifeline's DOM entanglement tracking.

#### Parameters

- `destroyable` **IDestroyable** the instance to remove the listener for
- `target` **EventTarget** the EventTarget, e.g. DOM element or `window`
- `eventName` **[String][37]** the event name to listen for
- `callback` **[Function][36]** the callback to run for that event
- `options` **any** additional options provided to the browser's `removeEventListener`

## Disposables

### registerDisposable

Registers a new disposable function to run for an instance. Will
handle lazily creating a new array to store the disposables per
instance if one does not exist. Will additionally patch an object's
`destroy` hook to ensure the destroyables are run/destroyed when
the object is destroyed.

#### Parameters

- `obj` **any** the instance to store the disposable for
- `dispose` **any** a function that disposes of instance resources

### runDisposables

Runs all disposables for a given instance.

#### Parameters

- `obj` **any** the instance to run the disposables for

## Mixins

### DisposableMixin

DisposableMixin provides a mechanism register disposables with automatic disposing when the
host object is destroyed.

### ContextBoundEventListenersMixin

ContextBoundEventListenersMixin provides a mechanism to attach event listeners
with runloops and automatic removal when the host object is removed from DOM.

### ContextBoundTasksMixin

ContextBoundTasksMixin provides a mechanism to run tasks (ala `setTimeout` or
`Ember.run.later`) with automatic cancellation when the host object is
destroyed.

These capabilities are very commonly needed, so this mixin is by default
included into all `Ember.View`, `Ember.Component`, and `Ember.Service` instances.

[1]: #run-loop-entanglement-via-task-functions
[2]: #runtask
[3]: #parameters
[4]: #polltask
[5]: #parameters-1
[6]: #polltaskfor
[7]: #parameters-2
[8]: #setshouldpoll
[9]: #parameters-3
[10]: #scheduletask
[11]: #parameters-4
[12]: #debouncetask
[13]: #parameters-5
[14]: #throttletask
[15]: #parameters-6
[16]: #canceltask
[17]: #parameters-7
[18]: #cancelpoll
[19]: #parameters-8
[20]: #canceldebounce
[21]: #parameters-9
[22]: #dom-event-handler-entanglement
[23]: #addeventlistener
[24]: #parameters-10
[25]: #removeeventlistener
[26]: #parameters-11
[27]: #disposables
[28]: #registerdisposable
[29]: #parameters-12
[30]: #rundisposables
[31]: #parameters-13
[32]: #mixins
[33]: #disposablemixin
[34]: #contextboundeventlistenersmixin
[35]: #contextboundtasksmixin
[36]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Statements/function
[37]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String
[38]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number
[39]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean
